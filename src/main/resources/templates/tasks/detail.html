<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>タスク詳細</title>
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.3.2/css/bootstrap.min.css}">
</head>
<body>
<h1 class="mt-3 ms-3">タスク詳細</h1>
<a th:href="@{/tasks?page={page}(page=${param.page})}" class="btn btn-primary mt-3 ms-3">タスク一覧</a>
<div class="mt-3 ms-3" th:object="${task}"> <!-- th:object -> オブジェクト指定  -->
    <hr>
    <h2 class="mt-3" th:text="'#' + *{id} + ' ' + *{summary}"></h2>
    <hr>
    <p class="mt-3" th:text="*{status}"></p>
    <hr>
    <pre class="mt-3" th:text="*{description}"></pre>
    <hr>
    <div th:each="com : ${comment}" th:object="${com}">
        <form th:action="@{/tasks/{id}/comments/{commentOrder}?page={page}
                             (id=${id}, commentOrder=*{tasks_order}, page=${param.page})}"
              th:method="delete">
            <div class="mt-3">
                <p style="display: inline;" th:text="*{content}"></p>
                <td th:text="' - ' + *{nickname}"></td>
                <!-- 削除は自身と管理者 -->
                <th:block th:if="${loginId} == *{loginId} or ${role} == 'ADMIN'">
                    <button type="submit">x</button>
                </th:block>
            </div>
        </form>
    </div>
    <form th:action="@{/tasks/{id}/comments?page={page}(id=${id}, page=${param.page})}" th:method="post">
        <div class="form-group">
            <textarea class="form-control mt-3" id="content" rows="1" name="content"></textarea>
        </div>
        <button type="submit" class="btn btn-primary mt-3" id="create-comment">コメント登録</button>
    </form>
    <hr>
    <div>
        <!-- 修正は自身だけ -->
        <th:block th:if="${loginId} == ${task.loginId}">
            <a th:href="@{/tasks/{id}/editForm?page={page}(id=${id}, page=${param.page})}" class="btn btn-primary mt-3">編集</a>
        </th:block>
        <!-- 削除は自身と管理者 -->
        <th:block th:if="${loginId} == ${task.loginId} or ${role} == 'ADMIN'">
        <form th:action="@{/tasks/{id}(id=${id})}"
              th:method="delete"
              style="display: inline;"
              onclick="return confirm('タスクを削除しますか？');">
            <button type="submit" class="btn btn-danger mt-3">削除</button>
        </form>
        </th:block>
    </div>
</div>
</body>
</html>